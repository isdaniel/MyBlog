---
title: Asp.net架構 & Asp.net MVC 原始碼－Model-Binding (第17天)
date: 
tags: [C#,Asp.net,Asp.net-MVC,SourceCode]
categories: [C#]
---

# Agenda<!-- omit in toc -->
- [前言](#%e5%89%8d%e8%a8%80)
- [IModelBinder(DefaultModelBinder)](#imodelbinderdefaultmodelbinder)
  - [ModelBinders](#modelbinders)

## 前言



## IModelBinder(DefaultModelBinder)

```csharp
public interface IModelBinder
{
    object BindModel(ControllerContext controllerContext,ModelBindingContext bindingContext);
}
```

`IModelBinder.BindModel`方法使用兩個參數

1. `ControllerContext`:`Controller`資訊，
2. `ModelBindingContext`:當前參數綁定資訊

我們能夠針對當前`Model`綁定建立相應`ModelBindingContext`物件，我們就能使用基於某個參數`ModelBinder`得到對應的參數值。關於`ModelBindingContext`建立我們會在後續部分進行的單獨介紹，

我們先來介紹一下`ModelBinder`提供機制。

### ModelBinders

```csharp
internal static IModelBinder GetBinderFromAttributes(Type type, Action<Type> errorAction)
{
    AttributeList allAttrs = new AttributeList(TypeDescriptorHelper.Get(type).GetAttributes());
    CustomModelBinderAttribute binder = allAttrs.SingleOfTypeDefaultOrError<Attribute, CustomModelBinderAttribute, Type>(errorAction, type);
    return binder == null ? null : binder.GetBinder();
}

internal static IModelBinder GetBinderFromAttributes(ICustomAttributeProvider element, Action<ICustomAttributeProvider> errorAction)
{
    CustomModelBinderAttribute[] attrs = (CustomModelBinderAttribute[])element.GetCustomAttributes(typeof(CustomModelBinderAttribute), true /* inherit */);
    // For compatibility, return null if no attributes.
    if (attrs == null)
    {                
        return null;
    }
    CustomModelBinderAttribute binder = attrs.SingleDefaultOrError(errorAction, element);
    return binder == null ? null : binder.GetBinder();
}
```

