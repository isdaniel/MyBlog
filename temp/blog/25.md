---
title: 從Asp.net框架角度進入Asp.net MVC原始碼－View (第25天)
date: 
tags: [C#,Asp.net,Asp.net-MVC,SourceCode]
categories: [C#]
---

# Agenda<!-- omit in toc -->
- [前言](#%e5%89%8d%e8%a8%80)
- [WebViewPage](#webviewpage)

## 前言

上一篇說到最終會透過一個實現`IView`物件(Razor是透過`RazorView`)來完成,`RenderView`方法將`BuildManagerCompiledView`方法取得物件轉換型別成`WebViewPage`.

`.cshtml`最終會編譯成一個繼承`WebViewPage`檔案.

本篇會來解析`View`編譯原理

## WebViewPage

`WebViewPage`繼承樹最頂層有個`WebPageExecutingBase`抽象類別,他擁有一個抽象方法`Execute`,`View`轉成`c#`程式會建立一個類別就會繼承於`WebViewPage`並把使用者頁面程式碼實現在`Execute`方法.

```csharp
public abstract void Execute();
```

先來看一下`View`產生的DLL檔案會放在哪裡

透過在`View`檔案上寫`@GetType().Assembly.Location`.

在頁面上顯示`DLL`存放位置.

```csharp
public class _Page_Views_Shared__Layout_cshtml : WebViewPage<object>
{
    protected global_asax ApplicationInstance
    {
        get
        {
            return (global_asax)this.get_Context().ApplicationInstance;
        }
    }

    public override void Execute()
    {
        //... user print logic
    }
}
```

透過反編譯工具可以看到原始碼,每個頁面都會產生相對應的類別並繼承於`WebViewPage<object>`類別(會因為使用泛型,因為有一個`@Model`)

> `Page_Views_Shared__Layout_cshtml`類別命名有個規則.
> `Page_Views_{ViewfolderName}_{ViewFileName}_{ExtensionFileName}`

我目前看到的是一個`_Layout`的`cshtml`檔案

